(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,10204,e=>{"use strict";var t=e.i(18050),a=e.i(71645);e.i(74080);var s=e.i(91918),r=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"].reduce((e,r)=>{let i=(0,s.createSlot)(`Primitive.${r}`),l=a.forwardRef((e,a)=>{let{asChild:s,...l}=e;return"undefined"!=typeof window&&(window[Symbol.for("radix-ui")]=!0),(0,t.jsx)(s?i:r,{...l,ref:a})});return l.displayName=`Primitive.${r}`,{...e,[r]:l}},{}),i=a.forwardRef((e,a)=>(0,t.jsx)(r.label,{...e,ref:a,onMouseDown:t=>{t.target.closest("button, input, select, textarea")||(e.onMouseDown?.(t),!t.defaultPrevented&&t.detail>1&&t.preventDefault())}}));i.displayName="Label";var l=e.i(75157);function n({className:e,...a}){return(0,t.jsx)(i,{"data-slot":"label",className:(0,l.cn)("flex items-center gap-2 text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50",e),...a})}e.s(["Label",()=>n],10204)},93479,e=>{"use strict";var t=e.i(18050),a=e.i(75157);function s({className:e,type:s,...r}){return(0,t.jsx)("input",{type:s,"data-slot":"input",className:(0,a.cn)("file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input h-9 w-full min-w-0 rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",e),...r})}e.s(["Input",()=>s])},31278,e=>{"use strict";let t=(0,e.i(75254).default)("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);e.s(["Loader2",()=>t],31278)},15288,e=>{"use strict";var t=e.i(18050),a=e.i(75157);function s({className:e,...s}){return(0,t.jsx)("div",{"data-slot":"card",className:(0,a.cn)("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",e),...s})}function r({className:e,...s}){return(0,t.jsx)("div",{"data-slot":"card-header",className:(0,a.cn)("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-2 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",e),...s})}function i({className:e,...s}){return(0,t.jsx)("div",{"data-slot":"card-title",className:(0,a.cn)("leading-none font-semibold",e),...s})}function l({className:e,...s}){return(0,t.jsx)("div",{"data-slot":"card-description",className:(0,a.cn)("text-muted-foreground text-sm",e),...s})}function n({className:e,...s}){return(0,t.jsx)("div",{"data-slot":"card-content",className:(0,a.cn)("px-6",e),...s})}function o({className:e,...s}){return(0,t.jsx)("div",{"data-slot":"card-footer",className:(0,a.cn)("flex items-center px-6 [.border-t]:pt-6",e),...s})}e.s(["Card",()=>s,"CardContent",()=>n,"CardDescription",()=>l,"CardFooter",()=>o,"CardHeader",()=>r,"CardTitle",()=>i])},27877,e=>{"use strict";e.s(["CATEGORY_LABELS",0,{ALL:{ko:"전체",en:"All"},PLANNING:{ko:"기획",en:"Planning"},SHOPPING:{ko:"쇼핑",en:"Shopping"},COOKING:{ko:"요리",en:"Cooking"},TRAVEL:{ko:"여행",en:"Travel"},ISSUE:{ko:"이슈",en:"Issue"}}])},14294,e=>{"use strict";var t=e.i(59141);e.i(36180);var a=e.i(98925);e.i(61086);var s=e.i(27215);let r="posts",i=async e=>{if(e&&e.includes("firebasestorage.googleapis.com"))try{let a=(0,s.ref)(t.storage,e);await (0,s.deleteObject)(a)}catch(e){console.error("Error deleting image from storage:",e)}},l=async(e="ALL")=>{try{let s=(0,a.query)((0,a.collection)(t.db,r),(0,a.where)("status","==","published"),(0,a.where)("publishedAt","<=",a.Timestamp.now()),(0,a.orderBy)("publishedAt","desc"),(0,a.limit)(20));return"ALL"!==e&&(s=(0,a.query)((0,a.collection)(t.db,r),(0,a.where)("status","==","published"),(0,a.where)("category","==",e),(0,a.where)("publishedAt","<=",a.Timestamp.now()),(0,a.orderBy)("publishedAt","desc"),(0,a.limit)(20))),(await (0,a.getDocs)(s)).docs.map(e=>({id:e.id,...e.data()}))}catch(e){return console.error("Error fetching posts:",e),[]}},n=async()=>{try{let e=(0,a.query)((0,a.collection)(t.db,r),(0,a.orderBy)("createdAt","desc"));return(await (0,a.getDocs)(e)).docs.map(e=>({id:e.id,...e.data()}))}catch(e){return console.error("Error fetching admin posts:",e),[]}},o=async e=>{try{let s=(0,a.doc)(t.db,r,e),i=await (0,a.getDoc)(s);if(i.exists())return{id:i.id,...i.data()};return null}catch(e){return console.error("Error fetching post:",e),null}},d=async e=>{try{let s=await o(e);if(s){s.thumbnail.url&&await i(s.thumbnail.url);let e=(e=>{let t,a=[],s=/<img[^>]+src="([^">]+)"/g;for(;null!==(t=s.exec(e));)t[1].includes("firebasestorage.googleapis.com")&&a.push(t[1]);return a})(s.content);await Promise.all(e.map(e=>i(e)))}return await (0,a.deleteDoc)((0,a.doc)(t.db,r,e)),!0}catch(e){throw console.error("Error deleting post:",e),e}},c=async(e,s)=>{try{if(s.thumbnail?.url!==void 0){let t=await o(e);t&&t.thumbnail?.url&&t.thumbnail.url!==s.thumbnail.url&&await i(t.thumbnail.url)}let{id:l,createdAt:n,...d}=s;return await (0,a.updateDoc)((0,a.doc)(t.db,r,e),{...d,updatedAt:a.Timestamp.now()}),!0}catch(e){throw console.error("Error updating post:",e),e}};e.s(["deletePost",0,d,"getAdminPosts",0,n,"getPost",0,o,"getPosts",0,l,"subscribeToAdminPosts",0,e=>{let s=(0,a.query)((0,a.collection)(t.db,r),(0,a.orderBy)("createdAt","desc"));return(0,a.onSnapshot)(s,t=>{e(t.docs.map(e=>({id:e.id,...e.data()})))},e=>{console.error("Error subscribing to admin posts:",e)})},"subscribeToPosts",0,(e,s)=>{let i=(0,a.query)((0,a.collection)(t.db,r),(0,a.where)("status","==","published"),(0,a.orderBy)("publishedAt","desc"),(0,a.limit)(20));return"ALL"!==e&&(i=(0,a.query)((0,a.collection)(t.db,r),(0,a.where)("status","==","published"),(0,a.where)("category","==",e),(0,a.orderBy)("publishedAt","desc"),(0,a.limit)(20))),(0,a.onSnapshot)(i,e=>{s(e.docs.map(e=>({id:e.id,...e.data()})))},e=>{console.error("Error subscribing to posts:",e)})},"updatePost",0,c])},67154,e=>{"use strict";var t=e.i(18050),a=e.i(71645),s=e.i(18566),r=e.i(27877),i=e.i(14294);e.i(36180);var l=e.i(98925),n=e.i(81139),o=e.i(19455),d=e.i(93479),c=e.i(10204),u=e.i(67489),h=e.i(24687),p=e.i(15288),m=e.i(61745),x=e.i(83086),b=e.i(31278),g=e.i(68993);function j({params:e}){let j=(0,s.useRouter)(),f=(0,m.useLocale)(),{id:y}=(0,a.use)(e),[v,w]=(0,a.useState)(""),[S,N]=(0,a.useState)(""),[C,T]=(0,a.useState)("ISSUE"),[A,L]=(0,a.useState)(""),[P,D]=(0,a.useState)(""),[E,I]=(0,a.useState)(""),[k,O]=(0,a.useState)(""),[B,R]=(0,a.useState)(""),[F,U]=(0,a.useState)(""),[G,$]=(0,a.useState)("published"),[q,M]=(0,a.useState)(""),[H,V]=(0,a.useState)(!1),[_,z]=(0,a.useState)(!0),[K,Y]=(0,a.useState)(!1),[J,Q]=(0,a.useState)("");(0,a.useEffect)(()=>{(async()=>{let e=await (0,i.getPost)(y);e?(w(e.title),N(e.content),T(e.category),L(e.excerpt||""),D(e.thumbnail.url||""),I(e.thumbnail.alt||""),O(e.seo.metaTitle||""),R(e.seo.metaDesc||""),U(e.excerpt||""),$(e.status),Q(e.shortCode||""),e.publishedAt&&M(new Date(1e3*e.publishedAt.seconds).toISOString().slice(0,16))):(alert("Post not found"),j.push(`/${f}/admin`)),z(!1)})()},[y,j,f]);let W=async()=>{if(S||v){Y(!0);try{let e=await fetch("/api/ai/generate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:"seo-metadata",content:`Title: ${v}

${S}`})}),t=await e.json();t.seoTitle&&O(t.seoTitle),t.seoDescription&&R(t.seoDescription);let a=await fetch("/api/ai/generate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:"tldr",content:S})}),s=await a.json();s.result&&U(s.result)}catch(e){console.error("AI Generation failed",e)}finally{Y(!1)}}},X=async e=>{if(e.preventDefault(),v&&S){V(!0);try{let e={title:v,content:S,excerpt:F||A,category:C,status:G,thumbnail:{url:P,alt:E||v},seo:{metaTitle:k||v,metaDesc:B||A,structuredData:{"@context":"https://schema.org","@type":"BlogPosting",headline:k||v,datePublished:q?new Date(q).toISOString():new Date().toISOString()}},shortCode:J||void 0};"scheduled"===G&&q?e.publishedAt=l.Timestamp.fromDate(new Date(q)):"published"!==G||q||(e.publishedAt=l.Timestamp.now()),await (0,i.updatePost)(y,e),alert("Post updated successfully"),j.push(`/${f}/admin`)}catch(e){console.error("Error updating document: ",e),alert("Failed to update post")}finally{V(!1)}}};return _?(0,t.jsx)("div",{className:"p-8 text-center",children:"Loading post..."}):(0,t.jsxs)("div",{className:"container mx-auto px-4 py-8 max-w-5xl",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center mb-8",children:[(0,t.jsx)("h1",{className:"text-3xl font-bold",children:"Edit Post"}),(0,t.jsxs)(o.Button,{type:"button",variant:"outline",onClick:W,disabled:K||!S&&!v,className:"gap-2",children:[K?(0,t.jsx)(b.Loader2,{className:"h-4 w-4 animate-spin"}):(0,t.jsx)(x.Sparkles,{className:"h-4 w-4 text-primary"}),"Generate AI Meta"]})]}),(0,t.jsxs)("form",{onSubmit:X,className:"space-y-6",children:[(0,t.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[(0,t.jsxs)("div",{className:"lg:col-span-2 space-y-6",children:[(0,t.jsxs)("div",{className:"space-y-4 bg-background p-6 rounded-lg border",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c.Label,{htmlFor:"title",children:"Title"}),(0,t.jsx)(d.Input,{id:"title",value:v,onChange:e=>w(e.target.value),placeholder:"Enter post title",required:!0,className:"text-lg font-medium"})]}),(0,t.jsxs)("div",{className:"space-y-2 pt-2 border-t border-dashed",children:[(0,t.jsx)(c.Label,{className:"text-xs text-muted-foreground",children:"Short URL (Optional)"}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsxs)("div",{className:"flex-grow bg-muted/50 rounded-md px-3 py-2 text-sm font-mono flex items-center justify-between border",children:[(0,t.jsx)("span",{children:J?`mars.it.kr/s/${J}`:"Not generated"}),J&&(0,t.jsx)("button",{type:"button",onClick:()=>{var e;return e=`https://mars.it.kr/s/${J}`,void(navigator.clipboard.writeText(e),alert("Copied to clipboard!"))},className:"text-primary hover:underline text-xs",children:"Copy"})]}),(0,t.jsx)(o.Button,{type:"button",variant:"outline",size:"sm",onClick:()=>{Q(Math.random().toString(36).substring(2,8).toUpperCase())},className:"whitespace-nowrap",children:J?"Regenerate":"Generate"})]})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c.Label,{children:"Content (Markdown)"}),(0,t.jsx)(n.MarkdownEditor,{content:S,onChange:N})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c.Label,{htmlFor:"tldr",children:"AI 핵심 요약 (TL;DR)"}),(0,t.jsx)(h.Textarea,{id:"tldr",value:F,onChange:e=>U(e.target.value),placeholder:"AI summary will appear here...",rows:3})]})]}),(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)(p.Card,{children:[(0,t.jsx)(p.CardHeader,{children:(0,t.jsx)(p.CardTitle,{className:"text-sm font-medium",children:"Publishing Settings"})}),(0,t.jsxs)(p.CardContent,{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c.Label,{htmlFor:"status",children:"Status"}),(0,t.jsxs)(u.Select,{value:G,onValueChange:e=>$(e),children:[(0,t.jsx)(u.SelectTrigger,{children:(0,t.jsx)(u.SelectValue,{placeholder:"Select status"})}),(0,t.jsxs)(u.SelectContent,{children:[(0,t.jsx)(u.SelectItem,{value:"published",children:"Published"}),(0,t.jsx)(u.SelectItem,{value:"draft",children:"Draft"}),(0,t.jsx)(u.SelectItem,{value:"scheduled",children:"Scheduled"})]})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c.Label,{htmlFor:"category",children:"Category"}),(0,t.jsxs)(u.Select,{value:C,onValueChange:e=>T(e),children:[(0,t.jsx)(u.SelectTrigger,{children:(0,t.jsx)(u.SelectValue,{placeholder:"Select category"})}),(0,t.jsx)(u.SelectContent,{children:Object.keys(r.CATEGORY_LABELS).map(e=>"ALL"!==e&&(0,t.jsx)(u.SelectItem,{value:e,children:r.CATEGORY_LABELS[e][f]},e))})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c.Label,{htmlFor:"publishedAt",children:"Scheduled Date"}),(0,t.jsx)(d.Input,{id:"publishedAt",type:"datetime-local",value:q,onChange:e=>M(e.target.value),className:"accent-primary"})]})]})]}),(0,t.jsxs)(p.Card,{children:[(0,t.jsx)(p.CardHeader,{children:(0,t.jsx)(p.CardTitle,{className:"text-sm font-medium",children:"SEO Optimization"})}),(0,t.jsxs)(p.CardContent,{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c.Label,{htmlFor:"seoTitle",children:"SEO Title"}),(0,t.jsx)(d.Input,{id:"seoTitle",value:k,onChange:e=>O(e.target.value),placeholder:"Search engine title"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c.Label,{htmlFor:"seoDescription",children:"SEO Description"}),(0,t.jsx)(h.Textarea,{id:"seoDescription",value:B,onChange:e=>R(e.target.value),placeholder:"Search engine summary",rows:3})]})]})]}),(0,t.jsxs)(p.Card,{children:[(0,t.jsx)(p.CardHeader,{children:(0,t.jsx)(p.CardTitle,{className:"text-sm font-medium",children:"Thumbnail"})}),(0,t.jsxs)(p.CardContent,{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c.Label,{htmlFor:"thumbnailUrl",children:"Thumbnail URL"}),(0,t.jsx)(d.Input,{id:"thumbnailUrl",value:P,onChange:e=>D(e.target.value),placeholder:"https://..."})]}),P&&(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)("div",{className:"relative aspect-video bg-muted rounded-md overflow-hidden",children:(0,t.jsx)("img",{src:P,alt:"Thumbnail preview",className:"w-full h-full object-cover"})}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c.Label,{htmlFor:"thumbnailAlt",children:"Alt Text"}),(0,t.jsx)(d.Input,{id:"thumbnailAlt",value:E,onChange:e=>I(e.target.value),placeholder:"Description for accessibility"})]})]})]})]}),(0,t.jsxs)(p.Card,{children:[(0,t.jsx)(p.CardHeader,{children:(0,t.jsx)(p.CardTitle,{className:"text-sm font-medium",children:"Social & Search Preview"})}),(0,t.jsx)(p.CardContent,{children:(0,t.jsx)(g.SocialPreview,{title:k||v,description:B||A||S.replace(/[#*`]/g,"").substring(0,160),thumbnailUrl:P,locale:f})})]})]})]}),(0,t.jsxs)("div",{className:"flex justify-end gap-4 border-t pt-6",children:[(0,t.jsx)(o.Button,{type:"button",variant:"outline",onClick:()=>j.back(),children:"Cancel"}),(0,t.jsx)(o.Button,{type:"submit",disabled:H||K,className:"px-8",children:H?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(b.Loader2,{className:"mr-2 h-4 w-4 animate-spin"})," Updating..."]}):"Update Post"})]})]})]})}e.s(["default",()=>j])}]);